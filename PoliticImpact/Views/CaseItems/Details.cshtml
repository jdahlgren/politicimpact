@model PoliticImpact.Models.CaseItem
@{
    ViewBag.Title = "Details";
}
<style>
    #share_by_email
    {
        display: none;
    }
    hr
    {
        border-bottom: 1px #808080 solid !important;
    }
</style>
<div class="row">
    <div class="span2">
        <!-- Button to trigger modal -->
        <a href="#shareCase" role="button" class="btn" data-toggle="modal">Share case</a>
    </div>
    @if (Model.enableLikes == true)
    {
        <div class="span2">
           @if (ViewBag.likeStatus == "signed")
            {
                //Kanske skall vara en bild istället?
                <p>You have liked this!</p>
            }
            else
            {
                <a href="@Url.Action("LikeCase", "CaseItems", new { id = @Model.ID }, null)">
                    <img src="~/Content/images/thumbs_up.png" width="75" height="75" id="ShowCaseLike" />
                </a>
            }
            <p>Number of likes: @ViewBag.numberOfLikes</p>
        </div>       
    }
    @if (Model.enableComments == true)
    {  
        <div class="span2">
            <img src="~/Content/images/Comment.png" width="75" height="75" onclick="ShowCommentField();" id="ShowCaseComment" />
        </div>
    }

    @if (Model.enableSigns == true)
    {
        <div class="span2">            
            @if (ViewBag.status == "signed")
            {
                //Kanske skall vara en bild istället?
            <p>You have signup for this case</p>
            }
            else
            {
            <a href="#signupCase" role="button" data-toggle="modal">
                <img src="~/Content/images/Signing.png" width="60" height="60" id="ShowCaseSign"/>
                </a>
            }
        </div>
    }
    @if (!Model.Published && Model.Owner == 1337)
    {
        <div class="span2">
            <a href="~/CaseItems/Edit/@Model.ID" class="btn">Edit</a>
        </div>
    }
</div>
<hr />
<div class="row">
   <h2>@Model.Title</h2>
    <p>
        @Model.Text
    </p>


    <div class="display-label">Deadline</div>
    <div class="display-field">@String.Format("{0:g}", Model.Deadline)</div>

    <div class="display-label">Reicever</div>
    <div class="display-field">@Model.RecieverName < @Model.RecieverEmail ></div>

            

        @if (Model.imageName != null)
        {
            <div class="display-label">imageId</div>
            <div class="display-field">@Model.imageId</div>
            <img src="@Model.imageName" width ="75" height ="75">
            <div class="display-label">imageBytes</div>
            <div class="display-field">@Html.DisplayTextFor(_ => Model.imageBytes).ToString()</div>
            <div class="display-label">imageName</div>
            <div class="display-field">@Model.imageName</div>
        }

    
    
        
       
    @* Visa respons från mottagare *@
    @{
        if (ViewBag.responded)
        {
            <form>
                <fieldset>
                    <legend>Responses by Reciever</legend>
                    <p>@ViewBag.response</p>
                </fieldset>
            </form>
        }  
    }
    @* slut på visa respons *@
   
    @*start: Frida Mattisson 2012-11-16*@

    @* Visa de 5 senaste kommentarerna från början, vid klick kommer en möjlighet att kommentera och alla kommentarer visas*@
             
    @*Print 5 comments for the case*@
    <div id="fiveComments">
        <fieldset>
            <legend>Comments</legend>
            @*Om kommentarerna är tomma*@
            @if (ViewBag.casecomments == null)
            {
                    <p id="nocomments">No comments for this case</p>
            }
            else
            {
                foreach (var comment in ViewBag.casecomments)
                {
                    <p>@comment.commentStr</p>
                }
            }
        </fieldset>
    </div>
        @*Print all comments for the case där id är samma*@
    <div id="newComment">
        <input type="text" id="newCommentStr" />
        <button onclick="PostComment(@Model.ID);">Post</button>
    </div>
    <div id="allComments">
        <fieldset>
            <legend id="titleComments">Comments</legend>
            @if (ViewBag.casecomments == null)
            {
                    <p id="nocomments">No comments for this case</p>
            }
            else
            {
                foreach (var comment in ViewBag.casecomments)
                {
                    <p>@comment.commentStr</p>
                }
            }
        </fieldset>
    </div>

    <!--Kommenteras bort tills att vi kan hämta data ur databasen
        
        @using (Html.BeginForm("CreateComment", "CaseItems", FormMethod.Post, new { @style = "display: none;", @id = "allComments" }))
        {
        @*<form style="display: none;" id="allComments">*@
        @Html.Hidden("caseID", Model.ID)
        @Html.TextBox("commentStr")

        @*<input aria-multiline="true" class="commentString"/>*@
        <input type="submit" value="Submit"/>
        <fieldset>
            <legend>Comments</legend>
            @if (Model.caseComment == null)
            {
                    <p>No comments for this case</p>
            }
            else
            {
                foreach (var comment in Model.caseComment)
                {
                    <p>comment.commentStr</p>
                }
            }
        </fieldset>
        }-->
    @*end: Frida Mattisson 2012-11-16*@
 

    @if (ViewBag.voting != null)
    {
        <h3>@ViewBag.voting.Title</h3>
        if (!ViewBag.UserHasVoted)
        {
            <div id="voting_container">
                <fieldset data-role="controlgroup">
                    <div id="voting-alternatives">
                        <input type="radio" name="voting-choice" id="voting-choice-1" value="yes" checked="checked" />
                        <label for="voting-choice-1">Yes</label>
                        <input type="radio" name="voting-choice" id="voting-choice-2" value="no"  />
                        <label for="voting-choice-2">No</label>
                    </div>
                    </fieldset>
                <button onclick="SendVote(@ViewBag.voting.VotingID);" id="btnVote">Vote</button>
            </div>
        }
        else
        {
            <p>You have already voted</p>
        }
    }
</div>

 



<!-- Modal -->
<div id="shareCase" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>Share @Model.Title</h3>
    </div>
    <div class="modal-body">
    <div style="padding:10px 20px;" >
			    
        <a onclick="publishStory('@Model.Title', '@Model.Text', '@Request.Url.AbsoluteUri');" data-theme="" id="ventaOption"> <img src="/Content/images/share-facebook.png" width="64" height="64"></a>
        <a id="emailShare" onclick="jQuery('#share_by_email').slideDown();"> <img src="/Content/images/share-email.png" width="64" height="64"></a>
	</div>
    <div id="share_by_email">
        <input type="email" name="email" id="friend_email" value=" " placeholder="Email to friend"/>
        <button onclick="ShareCaseByEmail(@Model.ID);">Send link</button>
    </div>
    </div>
    <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>

<!-- Button to trigger modal -->
 
<!-- Modal -->
<div id="signupCase" class="modal hide fade" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-header">
    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">×</button>
    <h3>Sign petition for @Model.Title</h3>
    </div>
    <div class="modal-body">
        <p>Do you want to sign the petition for  @Model.Title ? </p>
        <a href ="@Url.Action("SignUp", "CaseItems", new { caseitem = @Model.ID }, null) " data-role="button" data-theme= "b">Yes</a>
        <a href="#" data-rel="back" data-role="button" data-theme="b">No</a>
    </div>
    <div class="modal-footer">
    <button class="btn" data-dismiss="modal" aria-hidden="true">Close</button>
    </div>
</div>


<script>
    function ShareCaseByEmail(id) {
        jQuery.ajax({
            type: "POST",
            url: "/CaseItems/ShareMail/" + id,
            data: { email: jQuery('#friend_email').val() }
        }).done(function (msg) {
            jQuery('#share_by_email').html("<p>Email sent</p>");
            jQuery('#friend_email').val("");
        });
    }
</script>



